<h1>0 前言</h1>
本书讲述了InnoDB存储引擎的诸多功能和特性，还阐述了如何正确的使用这些功能和特性。

<h1>1 MySQL体系结构和存储引擎</h1>

<h2>1.1 定义数据库和实例</h2>
数据库和实例的定义

数据库：物理操作系统文件或其他形式文件类型的集合，在MySQL数据库中，数据库文件可以是frm、MYD、MYI结尾的文件

实例：MySQL数据库由后台线程以及一个共享的内存区组成，共享的内存可以被运行的后台线程所共享，数据库实例才是真正用于操作数据库文件的。
数据库操作insert、update 等是通过实例操作的

在MySQL中实例与数据库的关系通常是一一对应的，但是也存在集群环境下可能存在一个数据库被多个实例使用的情况。

MySQL被设计成一个单进程多线程架构的数据库，在系统上的表现就是一个进程。

<h2>1.2 MySQL体系结构</h2>

![](InnoDB存储引擎附录/MySQL体系结构.png)

如图所示：MySQL由以下几部分组成

1. 连接池组件
2. 管理服务和工具组件
3. SQL接口组件
4. 查询分析组件
5. 优化器组件
6. 缓冲组件
7. 插件式存储引擎
8. 物理文件

从图中可以看到，MySQL数据库区别于其他的数据库的最重要一个特点就是其插件式的表存储引擎。
MySQL插件式的存储引擎架构提供了一系列标准的管理和服务支持，这些标准与存储引擎本身无关，可能是每个系统必须的。
如SQL分析和优化器等，而存储引擎是底层物理结构的实现，每个存储引擎开发者可以按自己的意愿来进行开发。

需要特别注意的是，存储引擎是基于表的，而不是数据库。


<h2>1.3 MySQL存储引擎 </h2>
MySQL存储引擎是区别于其他数据库的一个重要特性。
存储引擎的好处是，每个存储引擎都有各自的特点，能够根据具体的应用建立不同的存储引擎表。

<h3>1.3.1 InnoDB存储引擎 </h3>
InnoDB存储引擎支持事务，其设计目标主要是面向在线事务处理（OLTP）的应用。
其特点是支持行级锁、支持外键、支持类似oracle的非读定锁（默认读取不会产生锁），MySQL从5.5.8开始后，默认存储引擎为InnoDB。

InnoDB存储引擎将数据放在一个逻辑的表空间中，从MySQL4.1之后它将每个表单独存放在一个ibd文件中。

InnoDB通过多版本并发控制（MVCC）来获得高并发性，并且实现了SQL标准的4个隔离级别，默认为REPEATABLE级别。
同时使用了next-key locking的策略来避免幻读，除此之外，InnoDB还提供了插入缓存、二次写、自适应哈希锁、预读等高性能和高可用的功能。

对于表中数据的存储，InnoDB存储引擎采用了聚集的方式、因此每张表的存储都是按照主键的顺序进行存储的。如果没有主键，InnoDB会为每一行生成一个6字节的ROWID，并以此作为主键。

<h3>1.3.2 MyISAM存储引擎 </h3>
MYISAM 不支持事务、表锁设计、支持全文索引，主要面向一些OLAP数据库应用。
在MySQL5.5.8之前是MySQL的默认存储引擎

MyISAM存储引擎由MYD和MYI组成，MYD用来存放数据文件，MYI用来存放索引文件。


<h3>1.3.3 NDB存储引擎 </h3>

NDB是一个集群存储引擎，类似于oracle的RAC集群。
不过与Oracle的RAC share everything架构不同的是，它的架构是 share nothing的集群架构，因此能提供更高的可用性。
NDB的特点是数据全部都放在内存中（MySQL5.1之后可以将非索引数据放在磁盘上）因此主键查找很快，并且可以通过添加节点线性的提高数据库性能，是高可用，高性能的集群系统。

NDB存储引擎的数据库连接是在MySQL层面完成的，而不是在存储引擎层面完成的，导致复杂查询的连接操作需要巨大的网络开销，所以查询很慢。

<h3>1.3.4 Memory存储引擎 </h3>
Memory存储引擎将表中的数据都放在内存中，如果数据库崩溃或重启，表中的数据都会消失，适合存临时数据的临时表。

Memory存储引擎默认使用哈希索引，而不是B+树索引。

虽然Memory很快，但是还是有一些缺陷，比如：只支持表锁、并发性能差、并且不支持TEXT和BLOB类型，而且存储varchar时，会按char去存储，因此会浪费内存

<h3>1.3.4 Archive存储引擎 </h3>
Archive存储引擎只支持insert和select操作，从MySQL5.1开始支持索引。

Archive存储引擎使用zlib算法将数据行进行压缩后存储，压缩比可达1:10，因此 Archive适合存储归档数据，如日志信息。
Archive存储引擎使用行锁来实现高并发的插入操作，但是其本身不是事务安全的存储引擎，设计目标主要是高速插入和压缩功能。

<h1>2 InnoDB存储引擎 </h1>
InnoDB是事务安全的存储引擎，设计上采用了类似oracle的架构，InnoDB存储引擎是OLTP应用中核心表的首选存储引擎。

<h2>2.1 InnoDB存储引擎的版本 </h2>

| 版本     | 内容                  |
|--------|---------------------|
| 老版本：   | 支持ACID、行锁、MVCC      |
| 1.0.x: | 增加 compress和dynamic |
| 1.1.x: | 增加 linux AIO、多回滚段   |
| 1.2.x: | 增加 全文索引支持、在线索引添加    |


<h2>2.1 InnoDB体系结构 </h2>





























