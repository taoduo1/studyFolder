<h1>一、cpu异常排查</h1>

1. 事件起因：
业务突然反馈，系统使用开始异常缓慢，在某个列表页数据一直加载不出来

2. 初步排查：
查看系统日志，发现系统运行正常，未发现数据库锁，未发现OOM异常，初步怀疑用户网络问题

3. 第二天，各个地方客户报告系统响应缓慢，排除客户本地问题，再次登录服务器，
使用top命令查看服务器内存空间足够，但是cpu占用率非常高，查看占用服务器最高的为java服务，查到此java服务pid
```
查找jvm进程ID: jps -lv 或者 ps aux | grep java
```
再根据pid，查找占用cpu较高的线程：
```
ps -mp pid -o THREAD,tid,time 找到占用cpu最高的tid (可以使用sort命令排序：sort -k 3 -r -n)
```
将tid转换为16进制的数字：
```
printf “%xn” tid
```
再使用jstack 命令，查询线程堆栈信息

```
jstack pid | grep 十六位tid -A 30
```
这时候就可以看到每个线程里面的状态和调用方法了

查到线程一直停留在一个一个方法里，没有结束。

找到此代码查询时在某个情况下会丢失掉查询参数，导致进行了全表查询，此表内数据大概百万左右。并进行了循环调用，修正此问题后上线异常情况消失。

